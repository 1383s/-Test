<!DOCTYPE html>
<html lang="ar" dir="rtl" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AHMED || Full Mark</title>

    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>

    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    
    <script>
        // ğŸš¨ Firebase Config Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© Ø§Ù„Ù„ÙŠ Ø­Ø·ÙŠØªÙŠÙ‡Ø§
        const firebaseConfig = {
          apiKey: "AIzaSyDH3cy-jkDphnPGzHUwd4rd9ogZDY7uUgM",
          authDomain: "quest-full.firebaseapp.com",
          projectId: "quest-full",
          storageBucket: "quest-full.firebasestorage.app",
          messagingSenderId: "501161882802",
          appId: "1:501161882802:web:08d6230eb09741a5c8c5ab",
          measurementId: "G-NDJ5YVHV1D"
        };
        
        // ğŸ’¡ ØªÙ‡ÙŠØ¦Ø© Firebase
        const firebaseApp = firebase.initializeApp(firebaseConfig);
        const db = firebase.database();
        const CODES_REF_PATH = 'approvedStudents';
        const STUDENT_CODE_KEY = "activeCode";

        // ğŸ’¡ ØªÙ‡ÙŠØ¦Ø© Tailwind ÙˆØ§Ù„Ø«ÙŠÙ…Ø§Øª
        const DARK_COLORS = {
            'bg-main': '#020A07',     
            'bg-card': '#0C241C',     
            'accent': '#08402C',      
            'text-primary': '#E6F0E8', 
        };
        const LIGHT_COLORS = {
            'bg-main': '#F7F7F7',     
            'bg-card': '#FFFFFF',     
            'accent': '#00A86B',      
            'text-primary': '#333333', 
        };

        window.tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        ...DARK_COLORS, // Default to dark for Tailwind classes
                        'like': '#00A86B', // Ø£Ø®Ø¶Ø± Ù„Ù„Ù€ Like
                        'dislike': '#E74C3C', // Ø£Ø­Ù…Ø± Ù„Ù„Ù€ Dislike
                        'mention': '#FFC300', // Ø£ØµÙØ± Ù„Ù„Ù…Ù†Ø´Ù†
                    },
                    fontFamily: { sans: ['Cairo', 'sans-serif'] }
                }
            }
        };

        // ğŸ’¡ Ø¯Ø§Ù„Ø© Ø§Ù„ØªØ¨Ø¯ÙŠÙ„ Ø¨ÙŠÙ† Ø§Ù„Ø«ÙŠÙ…Ø§Øª (ØªÙØ­ÙØ¸ ÙÙŠ localStorage)
        window.toggleTheme = (theme) => {
            if (theme === 'light') {
                document.documentElement.classList.remove('dark');
                localStorage.setItem('theme', 'light');
            } else {
                document.documentElement.classList.add('dark');
                localStorage.setItem('theme', 'dark');
            }
        };

        // ğŸ’¡ ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø«ÙŠÙ… Ø¹Ù†Ø¯ Ø§Ù„ØªØ­Ù…ÙŠÙ„
        const savedTheme = localStorage.getItem('theme') || 'dark';
        window.toggleTheme(savedTheme);

        // ğŸ’¡ Ø¯Ø§Ù„Ø© Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ÙƒÙˆØ¯
        async function checkCode(code) {
            try {
                // Ø§Ù„Ø¨Ø­Ø« ÙÙŠ Firebase Ø¹Ù† Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ù…ÙØ¹Ù‘Ù„
                const snapshot = await db.ref(`${CODES_REF_PATH}/${code}`).once('value');
                const studentData = snapshot.val();

                if (!studentData) {
                    return { success: false, message: 'Ø§Ù„ÙƒÙˆØ¯ ØºÙŠØ± ØµØ­ÙŠØ­ Ø£Ùˆ ØºÙŠØ± Ù…ÙØ¹Ù‘Ù„.' };
                }
                if (studentData.isBlocked) {
                    return { success: false, message: 'Ø¹ÙÙˆÙ‹Ø§ØŒ ØªÙ… Ø­Ø¸Ø± Ù‡Ø°Ø§ Ø§Ù„ÙƒÙˆØ¯.' };
                }
                if (studentData.expiry < Date.now()) {
                    return { success: false, message: 'Ø¹ÙÙˆÙ‹Ø§ØŒ Ø§Ù†ØªÙ‡Øª ØµÙ„Ø§Ø­ÙŠØ© Ù‡Ø°Ø§ Ø§Ù„ÙƒÙˆØ¯.' };
                }
                if (!studentData.section) {
                    return { success: false, message: 'Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø´Ø¹Ø¨Ø© ØºÙŠØ± Ù…ÙƒØªÙ…Ù„Ø©ØŒ ÙŠØ±Ø¬Ù‰ Ø§Ù„ØªÙˆØ§ØµÙ„ Ù…Ø¹ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©.' };
                }

                // Ù„Ùˆ Ø§Ù„ÙƒÙˆØ¯ ØµØ­ÙŠØ­
                return { success: true, studentData: studentData };

            } catch (error) {
                console.error("Firebase Check Error:", error);
                return { success: false, message: 'Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø´Ø¨ÙƒØ© Ø£Ùˆ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª.' };
            }
        }
    </script>
    
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
    <style>
        body { font-family: 'Cairo', sans-serif; transition: background-color 0.3s; }
        .dark { background-color: #020A07; }
        .dark .card { background-color: #0C241C; }
        .light { background-color: #F7F7F7; }
        .light .card { background-color: #FFFFFF; }
        .accent-bg { background-color: var(--accent); }
    </style>
</head>

<body class="h-screen flex items-center justify-center">

<div id="login-app" class="p-6 rounded-xl shadow-2xl w-full max-w-sm card">
    <div class="flex justify-between items-center mb-6">
        <h2 class="text-2xl font-bold text-accent">Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø·Ù„Ø§Ø¨ ğŸš€</h2>
        <div class="flex gap-2">
            <button @click="toggleTheme('dark')" class="text-gray-400 hover:text-text-primary" title="Dark Theme">
                <i class="ph ph-moon-stars text-xl"></i>
            </button>
            <button @click="toggleTheme('light')" class="text-gray-400 hover:text-text-primary" title="Light Theme">
                <i class="ph ph-sun text-xl"></i>
            </button>
        </div>
    </div>
    
    <form @submit.prevent="handleLogin" class="space-y-4">
        <input v-model="studentCodeInput" type="text" placeholder="Ø£Ø¯Ø®Ù„ ÙƒÙˆØ¯ Ø§Ù„ØªÙØ¹ÙŠÙ„" required
               class="w-full p-3 rounded border border-gray-600 focus:ring-accent focus:border-accent bg-gray-700 text-text-primary transition-colors">
        
        <button type="submit" :disabled="loading"
                class="w-full p-3 rounded font-bold text-lg bg-accent text-white hover:bg-opacity-90 transition-opacity">
            <span v-if="loading">Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ÙƒÙˆØ¯...</span>
            <span v-else>Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù…Ù†ØµØ©</span>
        </button>
    </form>
    
    <p v-if="errorMessage" class="mt-4 text-center text-red-500 font-medium">{{ errorMessage }}</p>
</div>

<script>
const { createApp, ref } = Vue;

createApp({
    setup() {
        const studentCodeInput = ref(localStorage.getItem(STUDENT_CODE_KEY) || '');
        const loading = ref(false);
        const errorMessage = ref('');

        const handleLogin = async () => {
            const code = studentCodeInput.value.trim();
            if (code.length === 0) {
                errorMessage.value = 'ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„ÙƒÙˆØ¯.';
                return;
            }
            
            loading.value = true;
            errorMessage.value = '';

            const result = await checkCode(code);
            
            if (result.success) {
                // Ø­ÙØ¸ Ø§Ù„ÙƒÙˆØ¯ ÙÙŠ localStorage ÙˆØªÙˆØ¬ÙŠÙ‡ Ø§Ù„Ø·Ø§Ù„Ø¨
                localStorage.setItem(STUDENT_CODE_KEY, code);
                localStorage.setItem('studentName', result.studentData.name || 'Ø·Ø§Ù„Ø¨');
                localStorage.setItem('studentSection', result.studentData.section);
                window.location.href = 'dashboard.html';
            } else {
                errorMessage.value = result.message;
            }
            
            loading.value = false;
        };

        return { studentCodeInput, loading, errorMessage, handleLogin, toggleTheme };
    }
}).mount('#login-app');

// ğŸ’¡ Ø¥Ø¹Ø§Ø¯Ø© ØªÙˆØ¬ÙŠÙ‡ Ù„Ùˆ Ø§Ù„ÙƒÙˆØ¯ Ù…Ø­ÙÙˆØ¸ Ø¨Ø§Ù„ÙØ¹Ù„
if (localStorage.getItem(STUDENT_CODE_KEY)) {
    window.location.href = 'dashboard.html';
}
</script>
</body>
</html>
