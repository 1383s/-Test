<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù…Ù†ØµØ© Ø³Ùˆ Ù„Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª | Ø´Ø§ØªÙŠ</title>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-color: #0d1117;
            --card-bg: #161b22;
            --text-color: #c9d1d9;
            --accent-color: #58a6ff;
            --success-color: #238636;
            --border-color: #30363d;
            --hover-color: #1f6feb;
        }

        body {
            font-family: 'Cairo', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            margin: 0; padding: 0;
        }

        header {
            text-align: center; padding: 30px;
            background: #161b22; border-bottom: 1px solid var(--border-color);
        }

        .container { max-width: 1000px; margin: 0 auto; padding: 20px; }
        
        #searchBar {
            width: 100%; max-width: 400px; padding: 12px; margin: 15px auto;
            display: block; border-radius: 8px; border: 1px solid var(--border-color);
            background: #0d1117; color: white; font-family: inherit;
        }

        .exams-grid {
            display: grid; grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            gap: 15px;
        }

        .exam-card {
            background: var(--card-bg); border: 1px solid var(--border-color);
            padding: 20px; border-radius: 12px; text-align: center;
            cursor: pointer; transition: 0.3s;
        }

        .exam-card:hover { border-color: var(--accent-color); transform: translateY(-5px); }

        /* Quiz UI */
        #quiz-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: var(--bg-color); z-index: 1000; display: none;
            overflow-y: auto; padding: 20px;
        }

        .question-card {
            background: var(--card-bg); border: 1px solid var(--border-color);
            border-radius: 15px; padding: 25px; margin-bottom: 20px;
        }

        .opt-btn {
            background: #21262d; border: 1px solid var(--border-color);
            color: var(--text-color); padding: 12px; border-radius: 8px;
            cursor: pointer; width: 100%; margin-top: 10px; font-family: inherit;
        }

        .opt-btn.selected { background: var(--hover-color); color: white; border-color: white; }

        .btn-submit {
            background: var(--success-color); color: white; padding: 15px 40px;
            border-radius: 8px; border: none; cursor: pointer; font-weight: bold;
            display: block; margin: 30px auto; font-family: inherit;
        }

        #result-display {
            padding: 20px; background: #23863622; border: 1px solid var(--success-color);
            border-radius: 10px; margin-top: 20px; display: none; text-align: center;
        }
    </style>
</head>
<body>

<div id="dashboard">
    <header>
        <h1>Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø³Ùˆ ğŸš€</h1>
        <input type="text" id="searchBar" placeholder="Ø§Ø¨Ø­Ø« Ø¹Ù† Ø±Ù‚Ù… Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±...">
    </header>
    <div class="container">
        <div class="exams-grid" id="exams-list"></div>
    </div>
</div>

<div id="quiz-overlay">
    <div class="container">
        <button onclick="location.reload()" style="background:none; border:none; color:var(--accent-color); cursor:pointer;">â¬… Ø¹ÙˆØ¯Ø©</button>
        <h2 id="quiz-title"></h2>
        <div id="quiz-questions"></div>
        <div id="result-display"></div>
        <button class="btn-submit" id="submit-btn" onclick="submitExam()">Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø§Øª Ù„Ù„Ø³ÙŠØ±ÙØ± Ø§Ù„Ø£ØµÙ„ÙŠ</button>
    </div>
</div>

<script>
    let currentId = null;
    let userAnswers = {}; // Ø§Ù„Ù‡ÙŠÙƒÙ„ Ø§Ù„Ø¬Ø¯ÙŠØ¯: Map (Object)

    // Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª
    const list = document.getElementById('exams-list');
    for(let i=42; i<=700; i++) {
        const div = document.createElement('div');
        div.className = 'exam-card';
        div.innerHTML = `<h3>Ø§Ø®ØªØ¨Ø§Ø± #${i}</h3>`;
        div.onclick = () => openQuiz(i);
        list.appendChild(div);
    }

    // Ø¨Ø­Ø«
    document.getElementById('searchBar').oninput = (e) => {
        const val = e.target.value;
        document.querySelectorAll('.exam-card').forEach(c => {
            c.style.display = c.innerText.includes(val) ? 'block' : 'none';
        });
    };

    async function openQuiz(id) {
        currentId = id;
        userAnswers = {};
        document.getElementById('quiz-overlay').style.display = 'block';
        const qDiv = document.getElementById('quiz-questions');
        qDiv.innerHTML = 'Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¯Ø§ØªØ§...';

        try {
            const res = await fetch(`Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª/exam_${id}.json`);
            const json = await res.json();
            const data = json.data.data;
            document.getElementById('quiz-title').innerText = data.exam.title;
            qDiv.innerHTML = '';

            data.questions.forEach(q => {
                const card = document.createElement('div');
                card.className = 'question-card';
                card.innerHTML = `
                    <p><strong>${q.text}</strong></p>
                    ${q.image_url ? `<img src="${q.image_url}" style="max-width:100%">` : ''}
                    <div id="group-${q.id}">
                        ${q.answers.map(a => `<button class="opt-btn" onclick="save('${q.id}', '${a.id}', this)">${a.text}</button>`).join('')}
                    </div>
                `;
                qDiv.appendChild(card);
            });
        } catch(e) { qDiv.innerHTML = 'âŒ Ø§Ù„Ù…Ù„Ù Ù…Ø´ Ù…ÙˆØ¬ÙˆØ¯'; }
    }

    function save(qid, aid, btn) {
        userAnswers[qid] = aid; // ØªØ®Ø²ÙŠÙ† Ø¨ØµÙŠØºØ© { "qid": "aid" }
        const parent = btn.parentElement;
        parent.querySelectorAll('.opt-btn').forEach(b => b.classList.remove('selected'));
        btn.classList.add('selected');
    }

    async function submitExam() {
        const btn = document.getElementById('submit-btn');
        btn.innerText = 'Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„...';
        btn.disabled = true;

        const url = `https://api.coursatk.online/api/v1/user/exams/${currentId}/submit`;
        const headers = {
            "Content-Type": "application/json",
            "Authorization": "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjo1MTM1OSwicm9sZSI6InN0dWRlbnQiLCJ1dWlkIjoiNDAyOTZkM2YxMDg4ZGM5ZjRmMWQ2MTE0ZjcwM2U2MDQifQ.RoPKriladUHqzewaO3D1F9_XWVdLiqyYRh_06aorQQI"
        };

        try {
            const res = await fetch(url, {
                method: 'POST',
                headers: headers,
                body: JSON.stringify({ answers: userAnswers }) // Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ù€ Object Ù…Ø¨Ø§Ø´Ø±Ø©
            });

            const result = await res.json();
            const display = document.getElementById('result-display');
            display.style.display = 'block';

            if(res.ok) {
                display.innerHTML = `<h3>âœ… ØªÙ… Ø§Ù„ØªØ³Ù„ÙŠÙ… Ø¨Ù†Ø¬Ø§Ø­</h3><p>Ø§Ù„Ø¯Ø±Ø¬Ø©: ${result.score || 'Ø´ÙˆÙÙ‡Ø§ ÙÙŠ Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø£ØµÙ„ÙŠ'}</p>`;
            } else {
                display.style.borderColor = 'red';
                display.innerHTML = `<h3>âŒ ÙØ´Ù„: ${result.error || 'Ø®Ø·Ø£ Ù…Ø¬Ù‡ÙˆÙ„'}</h3>`;
            }
        } catch(e) {
            alert('Ù…Ø´ÙƒÙ„Ø© ÙÙŠ CORSØŸ ÙØ¹Ù„ Ø¥Ø¶Ø§ÙØ© Allow CORS ÙÙŠ Ø§Ù„ÙƒØ±ÙˆÙ….');
        } finally {
            btn.innerText = 'Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø§Øª Ù„Ù„Ø³ÙŠØ±ÙØ± Ø§Ù„Ø£ØµÙ„ÙŠ';
            btn.disabled = false;
        }
    }
</script>
</body>
</html>
